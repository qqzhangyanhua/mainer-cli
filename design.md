1.1 产品愿景打造一个“懂意图、知环境、守安全”的终端智能助手，通过自然语言降低复杂运维任务的门槛，实现从“查文档写脚本”到“对话即交付”的转变。1.2 核心功能矩阵 (Feature Matrix)功能模块功能点详细描述智能交互双模形态CLI 模式用于快速单条指令；TUI 模式提供沉浸式对话与执行环境。意图识别基于 LLM 解析非结构化运维指令（中英文），自动匹配最优工具。环境感知上下文注入自动识别当前 OS、Shell、Docker 容器状态、当前路径等实时环境信息。任务执行编排式执行支持多步任务拆解（如：查日志 -> 找报错 -> 重启容器）。风险预警自动拦截/高亮 rm, kill, format 等高危操作，强制二次确认。审计与合规操作溯源完整记录：原始指令 -> 生成命令 -> 用户确认 -> 执行输出。1.3 核心业务流程 (User Journey)输入： 用户在终端输入 opsai "空间不足，清理一下"。感知： 系统检测到 /var/log 占用 90%。规划： Orchestrator 规划：1. 列出大文件；2. 建议清理旧日志。决策： TUI 展示建议命令，用户点击“执行”。归档： 执行成功，记录审计日志。二、 技术设计文档 (TDD) — 架构师总结文档定义： 定义系统“怎么实现”以及“技术标准”。2.1 逻辑架构图 (System Architecture)2.2 核心架构模式：Orchestrator–Workers系统采用 “大脑（编排）+ 肢体（执行）” 的解耦设计：Orchestrator (LLM Engine):核心逻辑： 采用 ReAct (Reason-Act) 循环。输入： Prompt = 环境上下文 + 用户意图 + Worker 技能描述。输出： 结构化 JSON 指令（调用哪个 Worker，传什么参数）。Worker Pool (Toolkits):System Worker: 负责基础文件系统操作 (os, shutil)。Container Worker: 负责容器管理 (docker-py)。Audit Worker: 负责本地 SQLite 或文件日志持久化。2.3 技术栈选型运行环境： Python 3.9+ (通过 uv 静态打包分发)。UI 层： Textual (TUI 框架) + Typer (CLI 解析)。AI 层： LiteLLM (支持多模型切换) + Pydantic (数据格式校验)。通信层： 异步 I/O (asyncio) 处理 LLM 流式输出与 subprocess 执行。2.4 安全设计策略权限最小化： 工具继承当前用户权限，不涉及提权操作。指令沙箱： 在 Worker 执行前，通过正则过滤和关键词黑名单进行硬性拦截。Human-in-the-loop (人工环路)： 架构上强制要求在高危指令执行前挂起状态，等待用户 UI 触发。
